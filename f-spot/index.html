<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>f-spot</title>

<link rel="stylesheet" href="../style.css" type="text/css" />

<link rel="stylesheet" href="../local.css" type="text/css" />






</head>
<body>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

<a href="../">wiki</a>/ 

</span>
<span class="title">
f-spot

</span>
</span>

</div>







</div>



<div id="pagebody">

<div id="content">
<h1>Updating photo locations in F-Spot database</h1>

<p>The sqlite database contains absolute paths to the photos. After moving
all photos from /home/vermaat/photos to /vermaat/photos I updated the
database (by default in ~/.gnome2/f-spot/photos.db) with this script:</p>

<pre><code>#!/usr/bin/python

from pysqlite2 import dbapi2 as sqlite

connection = sqlite.connect('photos.db')
cursor = connection.cursor()

cursor.execute("SELECT id, directory_path FROM photos WHERE directory_path LIKE '/home/vermaat%'")

photos = cursor.fetchall()

for (id, directory_path) in photos:
    print id
    cursor.execute("UPDATE photos SET directory_path = ? WHERE id = ?", 
                   (directory_path.replace("/home/vermaat", "/vermaat"), id))

connection.commit()
</code></pre>

<p>Update: sqlite3 features a replace function, and latest F-Spot seems to use a 'uri'
column instead of a 'directory_path' column, so the above would become:</p>

<pre><code>martijn@daphne:~$ sqlite3 photos.db 
SQLite version 3.5.9
Enter ".help" for instructions
sqlite&gt; update photos set uri = replace(uri,'file:///home/vermaat/','file:///vermaat/');
</code></pre>

<p>And a photo_versions table is also added:</p>

<pre><code>sqlite&gt; update photo_versions set uri = replace(uri,'file:///home/vermaat/','file:///vermaat/');
</code></pre>

<h1>Multi-user F-Spot</h1>

<p>Currently, F-Spot (0.3.5) is not designed for managing a photo collection with more
than one user. The following tricks make it possible.</p>

<p>Store all photos in a shared directory (e.g. /vermaat/photos) which is readable and
writable for all users and has the guid bit set. Move existing photos there and update
the photos.db database as explained above. Move the photos.db database to the shared
directory.</p>

<pre><code>martijn@melissa:/vermaat$ ls -l
drwxrwsr-x 57 martijn vermaat       4096 2007-05-13 17:16 photos
martijn@melissa:/vermaat$ ls -l photos/photos.db
-rw-rw---- 1 martijn vermaat 236544 2007-05-13 17:09 photos/photos.db
</code></pre>

<p>Make sure everything has the right group and permissions:</p>

<pre><code>chown -R martijn:vermaat /vermaat/photos
chmod -R ug+rwX /vermaat/photos
</code></pre>

<p>Run these commands from a cronjob to be sure the permissions are always correct.</p>

<p>Move the original f-spot binary to an alternative location and call it from the
new f-spot binary with database and photo locations as arguments:</p>

<pre><code>mv /usr/bin/f-spot /usr/bin/f-spot.real
</code></pre>

<p>Create a new /usr/bin/f-spot with the following contents:</p>

<pre><code>#!/bin/sh
/usr/bin/f-spot.real -b /vermaat/photos -p /vermaat/photos "${@}"
</code></pre>

<p>This should sort-of work in a multi-user environment.</p>

</div>





</div>

<div id="footer" class="pagefooter">

<div id="pageinfo">






<div id="backlinks">
Links:

<a href="../config/melissa/">config/melissa</a>

<a href="../">index</a>


</div>






<div class="pagedate">
Last edited <span class="date">Sat 25 Aug 2012 05:19:51 PM CEST</span>
<!-- Created <span class="date">Sat 25 Aug 2012 05:19:51 PM CEST</span> -->
</div>

</div>


<!-- from wiki -->
</div>

</div>

</body>
</html>
